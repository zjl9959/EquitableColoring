# 均衡图着色问题(Equitable Coloring Problem)

## 问题描述

+ 已知：无向图$(V, E)$，颜色数$K$
+ 约束：
    1. 相邻顶点不能染相同颜色$C_i \neq C_j$，如果$E(i,j)$存在
    2. 每个颜色集合之间分配的顶点数目之差不超过1

## 算法描述

首先随机构造一个初始解（一般会违反约束1），然后使用元启发式算法对初始解进行优化。

### 构造初始解

+ 随机为每个顶点分配颜色
+ 贪心构造初始解
    + [TODO]添加实现方案

### 局部搜索邻域动作设计

+ 优先考虑从大集合到小集合中的顶点交换
+ 其次考虑相同大小颜色集合之间的顶点交换
+ __EjectionChain__
    1. 从冲突边数目最多的顶点$V_a$开始，尝试为其染上不同的颜色
    2. 每当为顶点分配一个新的颜色，将该颜色集合中冲突数最多的顶点$V_b$拿出来
    3. 对顶点$V_b$重复过程1和2，直到超过最大交换长度限制，或一定步数内无法改进目标函数值

## 程序模块设计

### 文件结构

+ **common.h** 定义一些常用的数据

+ **data.h** 存放数据结构的定义，包括：
    + __Environment__：定义环境变量
        + 各种文件路径：算例名称，算例路径，解的路径，日志路径
        + 停止条件：最大运行时长，最大迭代步数
        + __Random__：随机数发生器
        + __Configure__：定义配置参数
    + __Assignment__：定义一个顶点到颜色的分配关系
    + __Edge__：定义图的边
    + __Graph__：定义拓扑图数据结构
    + __Solution__：定义解（Assignment的集合）

+ **inout.h & inout.cpp** 定义加载算例及保存结果的函数，包括：
    + **load_graph**函数：从算例文件中加载数据，构造Graph
    + **save**函数可能有多个重载：
        + 保存Solution到磁盘
        + 保存日志信息到磁盘
        + 保存其它中间信息到磁盘

+ **solver/** 文件夹放置各种求解算法
    + **tabu.h & tabu.cpp** : 禁忌搜索求解算法
    + **evolution.h & evolution.cpp** ：进化算法
    + **greedy.h & greedy.cpp** ：贪心算法

+ **test/** 文件夹放置单元测试代码
    + [TODO]添加测试模块设计方案

+ **checker.h & checker.cpp** 检验结果是否正确

+ **main.cpp** 程序入口

#### 关键类设计

+ **tabuSearch**：禁忌搜索算法
    + 考虑不同的禁忌策略：
        + 顶点$v$在$iter$步时从颜色$x$分配到颜色$y$，则$v$在未来$iter + tabu\_length$步内不能被分配到颜色x
        + 格局检测[TODO]
    + EjectionChain设计：
        + 邻域空间大小会随着链长呈指数增加，需要不断的回溯搜索，如何限制空间增长？
            + 顶点$v$在老的颜色集合中冲突边数目为$old$，在新的集合中冲突边数目为$new$，如果$new - old > threshold$，则不考虑该动作
            + 每一步挑选顶点时，只考虑冲突边数目最多的顶点（如果有多个则需要回溯/随机挑选一个）
            + 限制链的长度，且当当前顶点所在集合中无冲突顶点时，提前停止EjectionChain
        + 为当前顶点分配一个新的颜色集合时，以较大的概率将其分配到一个更小的集合中去，以较小的概率将其分配到相同的集合中去
    + 目标函数近似评估
        + 采用**冲突边的数目**作为目标函数
        + 采用**冲突边数目**及**颜色集合大小方差**的加权值作为目标函数

+ **HEAD**：两个解的进化算法
    + 交叉算符的实现：
        + 贪心交叉GPX算法
        + 模型求解
    + 父代解的相似度控制：
        + 最大二分匹配算法
